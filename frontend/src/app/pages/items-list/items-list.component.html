<div class="items-list">
  <div class="items-list--header">
    <h2>Products</h2>
    @if (!showNewItemForm()) {
      <button
        class="items-list--add-button"
        (click)="onShowNewItemForm()"
        test-add-new-item
      >
        Add New Product
      </button>
    }
  </div>

  @if (showNewItemForm()) {
    <app-new-item
      (productCreated)="onProductCreated($event)"
      (formClosed)="onNewItemFormClosed()"
    ></app-new-item>
  }

  @if (items$ | async; as items) {
    @if (items.length > 0) {
      @for (item of items; track item.id) {
        <app-list-item
          [item]="item"
          [isLoading]="isItemLoading(item.id)"
          (deleteItem)="onDeleteItem($event)"
          (increaseStock)="onIncreaseStock($event)"
          (decreaseStock)="onDecreaseStock($event)"
        ></app-list-item>
      }
    } @else {
      <div class="no-items">No products available</div>
    }
  }

  @if (loading) {
    <div class="loading">Loading products...</div>
  }

  @if (!hasNextPage && (items$ | async)?.length) {
    <div class="end-message">No more products to load</div>
  }

  <!-- Intersection Observer target element -->
  <div #listEnd class="list-end"></div>
</div>
